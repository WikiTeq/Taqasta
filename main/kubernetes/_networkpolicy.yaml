apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: default-denyall
spec:
  # An empty podSelector selects all pods in the namespace
  podSelector: {}
  policyTypes:
    - Ingress
    - Egress
  # No rules means "Deny All"
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-samenamespace
spec:
  # An empty podSelector selects all pods in the namespace
  podSelector: {}
  policyTypes:
    - Egress
    - Ingress
  egress:
  - to:
    - podSelector: {}
  ingress:
  - from:
    - podSelector: {}
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-from-ingress
spec:
  podSelector: {}
  policyTypes:
  - Ingress
  ingress:
  - from:
    - namespaceSelector:
        matchLabels:
          name: ingress
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-egress-dns
spec:
  # An empty podSelector selects all pods in the namespace
  podSelector: {}
  policyTypes:
    - Egress
  egress:
  - to:
    - ipBlock:
        cidr: 0.0.0.0/0
    ports:
    - protocol: UDP
      port: 53
---
# https://wikitech.wikimedia.org/wiki/IP_and_AS_allocations
# for gerrit.wikimedia.org sourced git modules
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-egress-mediawiki
spec:
  # An empty podSelector selects all pods in the namespace
  podSelector: {}
  policyTypes:
    - Egress
  egress:
  - to:
    - ipBlock:
        cidr: 185.15.56.0/22
    - ipBlock:
        cidr: 2a02:ec80::/29
    - ipBlock:
        cidr: 91.198.174.0/24
    - ipBlock:
        cidr: 195.200.68.0/24
    - ipBlock:
        cidr: 193.46.90.0/24
    - ipBlock:
        cidr: 2620:0:860::/46
    - ipBlock:
        cidr: 198.35.26.0/23
    - ipBlock:
        cidr: 208.80.152.0/22
    - ipBlock:
        cidr: 103.102.166.0/24
    - ipBlock:
        cidr: 2001:df2:e500::/48
    ports:
      - protocol: TCP
        port: 22
      - protocol: TCP
        port: 443
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-egress-github
spec:
  # An empty podSelector selects all pods in the namespace
  podSelector: {}
  policyTypes:
    - Egress
  egress:
  - to:
    - ipBlock:
        cidr: 192.30.252.0/22
    - ipBlock:
        cidr: 185.199.108.0/22
    - ipBlock:
        cidr: 140.82.112.0/20
    - ipBlock:
        cidr: 143.55.64.0/20
    - ipBlock:
        cidr: 2a0a:a440::/29
    - ipBlock:
        cidr: 2606:50c0::/32
    - ipBlock:
        cidr: 20.201.28.151/32
    - ipBlock:
        cidr: 20.205.243.166/32
    - ipBlock:
        cidr: 20.87.245.0/32
    - ipBlock:
        cidr: 4.237.22.38/32
    - ipBlock:
        cidr: 20.207.73.82/32
    - ipBlock:
        cidr: 20.27.177.113/32
    - ipBlock:
        cidr: 20.200.245.247/32
    - ipBlock:
        cidr: 20.175.192.147/32
    - ipBlock:
        cidr: 20.233.83.145/32
    - ipBlock:
        cidr: 20.29.134.23/32
    - ipBlock:
        cidr: 20.199.39.232/32
    - ipBlock:
        cidr: 20.217.135.5/32
    - ipBlock:
        cidr: 4.225.11.194/32
    - ipBlock:
        cidr: 4.208.26.197/32
    - ipBlock:
        cidr: 20.26.156.215/32
    - ipBlock:
        cidr: 20.201.28.152/32
    - ipBlock:
        cidr: 20.205.243.160/32
    - ipBlock:
        cidr: 20.87.245.4/32
    - ipBlock:
        cidr: 4.237.22.40/32
    - ipBlock:
        cidr: 20.207.73.83/32
    - ipBlock:
        cidr: 20.27.177.118/32
    - ipBlock:
        cidr: 20.200.245.248/32
    - ipBlock:
        cidr: 20.175.192.146/32
    - ipBlock:
        cidr: 20.233.83.149/32
    - ipBlock:
        cidr: 20.29.134.19/32
    - ipBlock:
        cidr: 20.199.39.227/32
    - ipBlock:
        cidr: 20.217.135.4/32
    - ipBlock:
        cidr: 4.225.11.200/32
    - ipBlock:
        cidr: 4.208.26.198/32
    - ipBlock:
        cidr: 20.26.156.214/32
    ports:
    - protocol: TCP
      port: 22
  - to:
    - ipBlock:
        cidr: 192.30.252.0/22
    - ipBlock:
        cidr: 185.199.108.0/22
    - ipBlock:
        cidr: 140.82.112.0/20
    - ipBlock:
        cidr: 143.55.64.0/20
    - ipBlock:
        cidr: 2a0a:a440::/29
    - ipBlock:
        cidr: 2606:50c0::/32
    - ipBlock:
        cidr: 20.201.28.151/32
    - ipBlock:
        cidr: 20.205.243.166/32
    - ipBlock:
        cidr: 20.87.245.0/32
    - ipBlock:
        cidr: 4.237.22.38/32
    - ipBlock:
        cidr: 20.207.73.82/32
    - ipBlock:
        cidr: 20.27.177.113/32
    - ipBlock:
        cidr: 20.200.245.247/32
    - ipBlock:
        cidr: 20.175.192.147/32
    - ipBlock:
        cidr: 20.233.83.145/32
    - ipBlock:
        cidr: 20.29.134.23/32
    - ipBlock:
        cidr: 20.199.39.232/32
    - ipBlock:
        cidr: 20.217.135.5/32
    - ipBlock:
        cidr: 4.225.11.194/32
    - ipBlock:
        cidr: 4.208.26.197/32
    - ipBlock:
        cidr: 20.26.156.215/32
    ports:
    - protocol: TCP
      port: 80
    - protocol: TCP
      port: 443
---
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-ovh-api
spec:
  podSelector:
    matchLabels:
      app: wiki
  policyTypes:
    - Egress
  egress:
    - to:
        - ipBlock:
            # got from whois s3.us-east-va.perf.cloud.ovh.us, put range for a test
            # was unable to find public information about OVH ranges for S3
            cidr: 51.81.0.0/16
